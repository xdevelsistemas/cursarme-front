machine:
  node:
    version: 0.10.32
  services:
    - docker
dependencies:
  override:
    - sudo pip install awscli
    - docker info
    - docker build -t claytonsilva/xduka-ui .
test:
  override:
    - docker run -d -p 80:3000 claytonsilva/xduka-ui; sleep 10
    - curl --retry 10 --retry-delay 5 -v http://localhost:3000
deployment:
  hub:
  branch: publicacao
  commands:
    - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
    - docker push circleci/elasticsearch
  aws:
    branch: publicacao
    commands:
    - npm install
    - npm install --dev
    - bower install
    - grunt
    - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
    - docker push circleci/elasticsearch
    - ssh core@beta.xduka.com.br sudo systemctl restart xduka-ui.service
